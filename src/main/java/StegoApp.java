import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.nio.file.FileSystems;
import java.nio.file.Path;
import java.util.Random;

import javax.imageio.ImageIO;
import javax.swing.JFrame;
import javax.swing.JScrollPane;
import javax.swing.ScrollPaneConstants;

import java.awt.*;

import com.google.zxing.WriterException;
import com.google.zxing.client.j2se.MatrixToImageWriter;


/*
 * This Java source file was generated by the Gradle 'init' task.
 */
public class StegoApp extends JFrame {
		
	public static BufferedImage coverImage, qrCode,
								oneBitStegoImage, threeBitStegoImage, fiveBitStegoImage,
								qrCodeOneBit, qrCodeThreeBit, qrCodeFiveBit;

	public static void main(String[] args) {
        try {
        		coverImage = ImageIO.read(new File("assets/18.pgm"));
        		
	        	// Create stego image
	        	EMD testingStego = new EMD(coverImage, 4, "Testing message bleep bloop", 35, 35);
			testingStego.embed();
			
			// Save qrcode before image
			Path path = FileSystems.getDefault().getPath("OUTPUT/qrCodeBefore.png");
	        MatrixToImageWriter.writeToPath(testingStego.getPayload(), "PNG", path);
	        
	        qrCode = MatrixToImageWriter.toBufferedImage(testingStego.extract());
			
			// Save QR code after
			File qrfileafter = new File("OUTPUT/qrCodeAfter.png");
			ImageIO.write(qrCode, "png", qrfileafter);
            
			// Decode QR code and output message
            String decodedText = Payload.decodeQRCode(qrCode);
            if(decodedText == null) {
                System.out.println("No QR Code found in the image");
            } else {
                System.out.println("Decoded text = " + decodedText);
            }
			
			LSB oneBit = new LSB(coverImage, 1, UI.secretMessage, 512, 512);
			oneBit.embed();
			
			LSB threeBit = new LSB(coverImage, 3, UI.secretMessage, 512, 512);
			threeBit.embed();
			
			LSB fiveBit = new LSB(coverImage, 5, UI.secretMessage, 512, 512);
			fiveBit.embed();
			
			// Save stego image
			File stegofile = new File("OUTPUT/stego.png");
			ImageIO.write(testingStego.getStegoImage(), "png", stegofile);
			
			oneBitStegoImage = oneBit.getStegoImage();
			threeBitStegoImage = threeBit.getStegoImage();
			fiveBitStegoImage = fiveBit.getStegoImage();
			
			// Extract QR code
			qrCode = MatrixToImageWriter.toBufferedImage(oneBit.extract());
			
			qrCodeOneBit = MatrixToImageWriter.toBufferedImage(oneBit.extract());
			qrCodeThreeBit = MatrixToImageWriter.toBufferedImage(threeBit.extract());
			qrCodeFiveBit = MatrixToImageWriter.toBufferedImage(fiveBit.extract());
			
			
        } catch (IOException e) {
            System.out.println("Could not generate QR Code or load image, IOException :: " + e.getMessage());
        }
        
		//new StegoApp("StegoCompare");

    } // end main
	
	public StegoApp(String title) {
		super(title);
		this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		
		UI mainPanel = new UI(null);
		this.add(mainPanel);
		this.pack();
		this.setLocationRelativeTo(null);
		this.setVisible(true);
		
	}
	
	public static BufferedImage getNewImage() throws IOException {
		BufferedImage newImage;
		int random = new Random().nextInt(19) + 1;
		newImage = ImageIO.read(new File("assets/" + random + ".pgm"));
		return newImage;	
	}
	
}
